{% extends "base.html" %}

{% block title %}ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰{% endblock %}

{% block content %}
<div class="dashboard">
    <h1>ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</h1>

    <!-- ã‚µãƒãƒªãƒ¼ã‚«ãƒ¼ãƒ‰ -->
    <div class="summary-cards">
        <div class="card" class="card-primary">
            <h3>ç·æ„è¦‹æ•°</h3>
            <p class="big-number">{{ total_opinions }}</p>
            <p class="sub-text">ä»¶</p>
        </div>

        <div class="card card-success">
            <h3>æœ¬æ—¥ã®æ„è¦‹</h3>
            <p class="big-number">{{ today_opinions }}</p>
            <p class="sub-text">ä»¶</p>
        </div>

        <div class="card card-info">
            <h3>ç™»éŒ²ãƒ¦ãƒ¼ã‚¶ãƒ¼</h3>
            <p class="big-number">{{ total_users }}</p>
            <p class="sub-text">äºº</p>
        </div>

        <div class="card card-warning">
            <h3>å®Œäº†ã‚»ãƒƒã‚·ãƒ§ãƒ³</h3>
            <p class="big-number">{{ total_sessions }}</p>
            <p class="sub-text">ä»¶</p>
        </div>
    </div>

    <!-- ã‚°ãƒ©ãƒ•ã‚¨ãƒªã‚¢ -->
    <div class="charts-row">
        <div class="chart-container">
            <h2>ã‚«ãƒ†ã‚´ãƒªåˆ¥åˆ†å¸ƒ</h2>
            <div class="category-chart">
                {% for cat in category_stats %}
                <div class="category-item">
                    <span class="category-label">{{ cat.category or 'ãã®ä»–' }}</span>
                    <div class="category-bar-container">
                        <div class="category-bar"
                            style="width: {{ (cat.count / total_opinions * 100) if total_opinions > 0 else 0 }}%"></div>
                    </div>
                    <span class="category-count">{{ cat.count }}ä»¶</span>
                </div>
                {% endfor %}
            </div>
        </div>

        <div class="chart-container">
            <h2>ã‚½ãƒ¼ã‚¹åˆ¥åˆ†å¸ƒ</h2>
            <div class="source-chart">
                {% for src in source_stats %}
                <div class="source-item">
                    <span class="source-label">
                        {% if src.source_type == 'chat' %}ğŸ’¬ å¯¾è©±å‹
                        {% elif src.source_type == 'free_form' %}ğŸ“ è‡ªç”±è¨˜è¿°
                        {% elif src.source_type == 'poll' %}ğŸ“Š é¸æŠå¼
                        {% else %}{{ src.source_type }}
                        {% endif %}
                    </span>
                    <span class="source-count">{{ src.count }}ä»¶ ({{ "%.1f"|format((src.count / total_opinions * 100) if
                        total_opinions > 0 else 0) }}%)</span>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>

    <!-- æ—¥åˆ¥æ¨ç§» -->
    <div class="chart-container full-width">
        <h2>éå»7æ—¥é–“ã®æ¨ç§»</h2>
        <div class="daily-chart">
            {% for day in daily_stats %}
            <div class="daily-item">
                <span class="daily-label">{{ day.date }}</span>
                <div class="daily-bar-container">
                    <div class="daily-bar"
                        style="height: {{ (day.count / daily_stats_max * 100) if daily_stats else 0 }}%">
                        <span class="daily-count">{{ day.count }}</span>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- æœ€è¿‘ã®æ„è¦‹ -->
    <div class="recent-opinions">
        <h2>æœ€è¿‘ã®æ„è¦‹</h2>
        <table class="opinions-table">
            <thead>
                <tr>
                    <th>æ—¥æ™‚</th>
                    <th>ã‚«ãƒ†ã‚´ãƒª</th>
                    <th>å†…å®¹</th>
                    <th>ã‚½ãƒ¼ã‚¹</th>
                    <th>æ„Ÿæƒ…</th>
                </tr>
            </thead>
            <tbody>
                {% for op in recent_opinions %}
                <tr>
                    <td>{{ op.created_at.strftime('%m/%d %H:%M') }}</td>
                    <td><span class="badge">{{ op.category or 'ãã®ä»–' }}</span></td>
                    <td class="opinion-content">{{ op.content[:60] }}{% if op.content|length > 60 %}...{% endif %}</td>
                    <td>
                        {% if op.source_type == 'chat' %}ğŸ’¬
                        {% elif op.source_type == 'free_form' %}ğŸ“
                        {% elif op.source_type == 'poll' %}ğŸ“Š
                        {% endif %}
                    </td>
                    <td>
                        <span class="emotion-score score-{{ (op.emotion_score // 3) if op.emotion_score else 0 }}">
                            {{ op.emotion_score if op.emotion_score else '-' }}
                        </span>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}