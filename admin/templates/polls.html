{% extends "base.html" %}

{% block title %}æŠ•ç¥¨ç®¡ç† - æšæ–¹å¸‚æ°‘ãƒ‹ãƒ¼ã‚ºæŠ½å‡ºã‚·ã‚¹ãƒ†ãƒ {% endblock %}

{% block content %}
<div class="container">
    <div class="header-section">
        <h1>ğŸ“Š æŠ•ç¥¨ç®¡ç†</h1>
        <button onclick="showCreateModal()" class="btn-primary">æ–°è¦æŠ•ç¥¨ä½œæˆ</button>
    </div>

    <!-- æŠ•ç¥¨ä¸€è¦§ -->
    <div class="card">
        <h2>æŠ•ç¥¨ä¸€è¦§</h2>

        {% if polls %}
        <table class="data-table">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>è³ªå•</th>
                    <th>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</th>
                    <th>å›ç­”æ•°</th>
                    <th>ä½œæˆæ—¥æ™‚</th>
                    <th>æ“ä½œ</th>
                </tr>
            </thead>
            <tbody>
                {% for poll in polls %}
                <tr>
                    <td>{{ poll.id }}</td>
                    <td>{{ poll.title[:50] }}...</td>
                    <td>
                        <span class="badge badge-{{ poll.status }}">
                            {{ poll.status }}
                        </span>
                    </td>
                    <td>{{ poll.response_count }}ä»¶</td>
                    <td>{{ poll.created_at.strftime('%Y-%m-%d %H:%M') }}</td>
                    <td class="actions">
                        {% if poll.status == 'draft' %}
                        <a href="{{ url_for('send_poll', poll_id=poll.id) }}"
                            class="btn-small btn-success" onclick="return confirm('ã“ã®æŠ•ç¥¨ã‚’é…ä¿¡ã—ã¾ã™ã‹ï¼Ÿ')">é…ä¿¡</a>
                        {% elif poll.status == 'published' %}
                        <a href="{{ url_for('send_poll', poll_id=poll.id) }}"
                            class="btn-small btn-warning" onclick="return confirm('ã€æ³¨æ„ã€‘ã“ã®æŠ•ç¥¨ã¯æ—¢ã«å…¬é–‹ã•ã‚Œã¦ã„ã¾ã™ã€‚\nå†é…ä¿¡ã—ã¾ã™ã‹ï¼Ÿ')">å†é…ä¿¡</a>
                        {% endif %}
                        <a href="{{ url_for('poll_results', poll_id=poll.id) }}"
                            class="btn-small">çµæœ</a>
                        {% if poll.status == 'published' %}
                        <a href="{{ url_for('close_poll', poll_id=poll.id) }}"
                            class="btn-small btn-danger" onclick="return confirm('ã“ã®æŠ•ç¥¨ã‚’ç· ã‚åˆ‡ã‚Šã¾ã™ã‹ï¼Ÿ')">ç· åˆ‡</a>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% else %}
        <p class="no-data">æŠ•ç¥¨ãŒã‚ã‚Šã¾ã›ã‚“ã€‚æ–°è¦ä½œæˆã—ã¦ãã ã•ã„ã€‚</p>
        {% endif %}
    </div>
</div>

<!-- æ–°è¦ä½œæˆãƒ¢ãƒ¼ãƒ€ãƒ« -->
<div id="createModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="hideCreateModal()">&times;</span>
        <h2>æ–°è¦æŠ•ç¥¨ä½œæˆ</h2>

        <form method="POST" action="{{ url_for('create_poll') }}">
            <div class="form-group">
                <label for="question">è³ªå• <span class="required">*</span></label>
                <input type="text" id="question" name="question" required maxlength="200"
                    placeholder="ä¾‹: é§…å‰ã®é–‹ç™ºã«ã¤ã„ã¦ã€ã©ã†æ€ã„ã¾ã™ã‹ï¼Ÿ">
            </div>

            <div class="form-group">
                <label>é¸æŠè‚¢ï¼ˆ4ã¤å¿…é ˆï¼‰ <span class="required">*</span></label>
                <input type="text" name="choice_1" required placeholder="1. ">
                <input type="text" name="choice_2" required placeholder="2. ">
                <input type="text" name="choice_3" required placeholder="3. ">
                <input type="text" name="choice_4" required placeholder="4. ">
            </div>

            <div class="form-group">
                <label for="description">èª¬æ˜ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰</label>
                <textarea id="description" name="description" rows="3" placeholder="è¿½åŠ ã®èª¬æ˜ãŒã‚ã‚Œã°è¨˜å…¥ã—ã¦ãã ã•ã„"></textarea>
            </div>

            <div class="form-actions">
                <button type="button" onclick="hideCreateModal()" class="btn-secondary">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                <button type="submit" class="btn-primary">ä½œæˆ</button>
            </div>
        </form>
    </div>
</div>

<style>
    .header-section {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 30px;
    }

    .badge {
        padding: 4px 12px;
        border-radius: 12px;
        font-size: 12px;
        font-weight: 600;
    }

    .badge-draft {
        background: #95a5a6;
        color: white;
    }

    .badge-published {
        background: #27ae60;
        color: white;
    }

    .badge-closed {
        background: #e74c3c;
        color: white;
    }

    .btn-small {
        padding: 6px 12px;
        font-size: 14px;
        margin: 0 4px;
    }

    .btn-success {
        background: #27ae60;
    }

    .btn-success:hover {
        background: #229954;
    }

    .btn-danger {
        background: #e74c3c;
    }

    .btn-danger:hover {
        background: #c0392b;
    }

    .btn-warning {
        background: #f39c12;
        color: white;
    }

    .btn-warning:hover {
        background: #d68910;
    }

    .actions {
        white-space: nowrap;
    }

    .no-data {
        text-align: center;
        padding: 40px;
        color: #7f8c8d;
    }

    /* ãƒ¢ãƒ¼ãƒ€ãƒ« */
    .modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
    }

    .modal-content {
        background: white;
        margin: 5% auto;
        padding: 30px;
        border-radius: 8px;
        max-width: 600px;
        position: relative;
    }

    .close {
        position: absolute;
        right: 20px;
        top: 20px;
        font-size: 28px;
        font-weight: bold;
        cursor: pointer;
    }

    .close:hover {
        color: #e74c3c;
    }

    .form-group input[type="text"],
    .form-group textarea {
        width: 100%;
        padding: 10px;
        margin: 8px 0;
        border: 1px solid #ddd;
        border-radius: 4px;
    }

    .form-actions {
        display: flex;
        gap: 12px;
        justify-content: flex-end;
        margin-top: 24px;
    }

    .required {
        color: #e74c3c;
    }
</style>

<script>
    function showCreateModal() {
        document.getElementById('createModal').style.display = 'block';
    }

    function hideCreateModal() {
        document.getElementById('createModal').style.display = 'none';
    }

    // ãƒ¢ãƒ¼ãƒ€ãƒ«å¤–ã‚¯ãƒªãƒƒã‚¯ã§é–‰ã˜ã‚‹
    window.onclick = function (event) {
        const modal = document.getElementById('createModal');
        if (event.target == modal) {
            modal.style.display = 'none';
        }
    }
</script>
{% endblock %}
